# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é FastAPI –≤–µ—Ä—Å–∏–∏

## üéØ –ì–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è Swagger?

**Swagger UI –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:** http://localhost:8000/docs

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ —ç—Ç–æ—Ç –∞–¥—Ä–µ—Å –≤ –±—Ä–∞—É–∑–µ—Ä–µ, –∏ –≤—ã —É–≤–∏–¥–∏—Ç–µ –ø–æ–ª–Ω—É—é –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é API —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ.

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –∞–¥—Ä–µ—Å–∞:
- **ReDoc**: http://localhost:8000/redoc
- **OpenAPI JSON**: http://localhost:8000/openapi.json

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
cd fastapi_app
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`:
```bash
OPENROUTER_API_KEY=your_key
PIXELBIN_ACCESS_TOKEN=your_token
FAL_KEY=your_fal_key
HF_TOKEN=your_hf_token
```

### 3. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
```bash
uvicorn app.main:app --reload
```

### 4. –û—Ç–∫—Ä—ã—Ç—å Swagger
–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: **http://localhost:8000/docs**

## üìã –ü–æ–ª–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å endpoints

### POST /api/analyze
**–ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å:**
- ‚úÖ –†–µ–∂–∏–º Pixelbin (—Å –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∏ fallback)
- ‚úÖ –†–µ–∂–∏–º SAM3 (—Å LLM pre-analysis, RAG, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –º–∞—Å–æ–∫)
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è overlay –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –º–∞—Å–∫–∞–º–∏
- ‚úÖ –≠–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∫–∞–∫ fallback
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ HEIC –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–æ–≤ –Ω–∞ —Ä—É—Å—Å–∫–æ–º/–∞–Ω–≥–ª–∏–π—Å–∫–æ–º

### GET /api/config
–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### POST /api/config
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (—á–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)

### GET /api/models/available
–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏

### GET /api/proxy-image
–ü—Ä–æ–∫—Å–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –æ–±—Ö–æ–¥–∞ CORS (Pixelbin, FAL)

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
```bash
pytest -v
```

### –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
```bash
# –¢–µ—Å—Ç—ã API
pytest tests/test_api.py -v

# –¢–µ—Å—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤
pytest tests/test_services.py -v

# –¢–µ—Å—Ç—ã —É—Ç–∏–ª–∏—Ç
pytest tests/test_utils.py -v

# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
pytest tests/test_integration.py -v
```

### –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞
```bash
pytest --cov=app --cov-report=html
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

- **test_utils.py** - —Ç–µ—Å—Ç—ã —É—Ç–∏–ª–∏—Ç (–ø–∞—Ä—Å–∏–Ω–≥, –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è, —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è)
- **test_services.py** - —Ç–µ—Å—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤ (Pixelbin, LLM)
- **test_schemas.py** - —Ç–µ—Å—Ç—ã Pydantic —Å—Ö–µ–º (–≤–∞–ª–∏–¥–∞—Ü–∏—è)
- **test_api.py** - —Ç–µ—Å—Ç—ã API endpoints
- **test_integration.py** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (Swagger, OpenAPI)
- **test_constants.py** - —Ç–µ—Å—Ç—ã –∫–æ–Ω—Å—Ç–∞–Ω—Ç

## üîç –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Swagger UI

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8000/docs
2. –í—ã–±–µ—Ä–∏—Ç–µ endpoint (–Ω–∞–ø—Ä–∏–º–µ—Ä, `POST /api/analyze`)
3. –ù–∞–∂–º–∏—Ç–µ "Try it out"
4. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
   - `image`: base64 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
   - `mode`: "pixelbin" –∏–ª–∏ "sam3"
   - `config`: –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
5. –ù–∞–∂–º–∏—Ç–µ "Execute"
6. –£–≤–∏–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –∞–Ω–∞–ª–∏–∑–∞

## ‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ü–æ–ª–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å analyze endpoint:
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–≤—É—Ö —Ä–µ–∂–∏–º–æ–≤ (pixelbin/sam3)
- ‚úÖ –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è Pixelbin
- ‚úÖ –ü–æ–ø—ã—Ç–∫–∏ —Å –æ—Ä–∏–≥–∏–Ω–∞–ª–æ–º –∏ –ø—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥–æ–º
- ‚úÖ SAM3 —Å LLM pre-analysis –∏ RAG
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –º–∞—Å–æ–∫ –ø–æ —Ä–∞–∑–º–µ—Ä—É –ø–æ–∫—Ä—ã—Ç–∏—è
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è overlay –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å —Ä—É—Å—Å–∫–∏–º–∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏
- ‚úÖ –≠–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∫–∞–∫ fallback
- ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- ‚úÖ –í—Å–µ –æ–ø–∏—Å–∞–Ω–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- ‚úÖ –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤
- ‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- ‚úÖ –ö–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤ –∏ –æ—à–∏–±–æ–∫

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ê–Ω–∞–ª–∏–∑ –≤ —Ä–µ–∂–∏–º–µ Pixelbin
```json
POST /api/analyze
{
  "image": "data:image/jpeg;base64,/9j/4AAQ...",
  "mode": "pixelbin",
  "config": {
    "vision_model": "google/gemini-2.5-flash",
    "temperature": 0.0,
    "language": "ru"
  }
}
```

### –ê–Ω–∞–ª–∏–∑ –≤ —Ä–µ–∂–∏–º–µ SAM3
```json
POST /api/analyze
{
  "image": "data:image/jpeg;base64,/9j/4AAQ...",
  "mode": "sam3",
  "sam3_timeout": 10,
  "sam3_diseases": ["acne", "pigmentation", "wrinkles"],
  "sam3_use_llm_preanalysis": true,
  "sam3_max_coverage_percent": 25.0
}
```

## üéâ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã. Swagger –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `/docs` –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞.

